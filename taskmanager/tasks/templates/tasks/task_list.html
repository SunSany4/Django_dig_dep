{% load static %}
<link rel="stylesheet" type="text/css" href="{% static 'css/style.css' %}">

<!-- <script>
    setTimeout(function(){
        let messages = document.querySelector('.messages');
        if (messages) {
            messages.style.display = 'none';
        }
    }, 2000);
</script> -->

<script>
    document.addEventListener('DOMContentLoaded', function () {
        let messages = document.querySelectorAll('.messages li');
        if (messages) {
        messages.forEach(function(message) {
            setTimeout(() => {
                message.style.animation = 'fadeOut 0.5s ease-in-out';
                setTimeout(() => {
                    message.remove();
                }, 500);
            }, 2000);
        })
    }
    })
</script>
{% load static %}
<script src="{% static 'js/sript.js' %}"></script>



<h2>–§–∏–ª—å—Ç—Ä</h2>
<form method="GET" action="{% url 'tasks' %}"> 
    <label for="category">–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</label>
    <select name="category" id="category">
        <option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
        {% for category in categories %}
        <option value="{{ category.id }}" {% if request.GET.category == category.id|stringformat:"s" %} selected {% endif %}>
            {{ category.name }}
        </option>
        {% endfor %}
    </select>
        <label for="status">–°—Ç–∞—Ç—É—Å:</label>
        <select name="status" id="status">
            <option value="">–í—Å–µ</option>
            
            <option value="completed" {% if request.GET.status == "completed" %} selected {% endif %}>
                –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ
            </option>
            <option value="incomplete" {% if request.GET.status == "incomplete" %} selected {% endif %}>
                –ù–µ–≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ
            </option>
        </select>
        <button type="submit">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
</form>

<!-- –ü–æ–∏—Å–∫ –∑–∞–¥–∞—á -->
 <form method="get">
    <input type="text" name="q" placeholder="–ü–æ–∏—Å–∫ –∑–∞–¥–∞—á" value="{{ query }}">
    <button type="submit">–ù–∞–∏ÃÜ—Ç–∏</button>
 </form>

<h2>–í–∞—à–∏ —Ç–µ–∫—É—â–∏–µ –∑–∞–¥–∞—á–∏</h2>
<!-- –°–æ–æ–±—â–µ–Ω–∏—è -->
{% if messages %}
<ul class="messages">
    {% for message in messages %}
    <li class="{{ message.tags }}">{{ message }}</li>
    {% endfor %}
</ul>
{% endif %}
<!-- <a href="{% url 'create_task' %}" class="btn-create" id="open-modal">–°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É ‚ûï</a> -->
<a href="#" class="btn-create" id="open-modal">–°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É ‚ûï</a>
<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ -->
 <div id="task-modal" class="modal">
    <div class="modal-content">
        <span class="close-modal" id="close-modal">√ó</span>
        <h2>–°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É</h2>
        <form method="post" id="task-form">
            {% csrf_token %}
            <label for="title"> –ù–∞–∑–≤–∞–Ω–∏–µ</label>
            <input type="text" name="title" id="title" required>

            <label for="description">–û–ø–∏—Å–∞–Ω–∏–µ</label>
            <textarea name="description" id="description"></textarea>

            <label for="category">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
            <select name="category" id="category">
                {% for category in categories %}
                <option value="{{ category.id }}">{{ category.name }}</option>
                {% endfor %}
            </select>
            
            <button type="submit">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        </form>
        <a href="{% url 'tasks' %}">–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Å–ø–∏—Å–∫—É –∑–∞–¥–∞—á</a>
    </div>
</div>


<!-- –°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á -->
<ul id="task-list">
    {% for task in page_obj %}
    <li class="task-item" data-task-id="{{ task.id }}" data-completed="{{ task.completed }}">
        <strong class="task-title {% if task.completed %} completed {% endif %}"> {{ task.title }} {% if task.completed %} ‚úî {% else %} ‚ùå {% endif %}</stron> 
        <span class="task-desc">{{ task.description }}  </span>
        <span class="category"> {{ task.category.name }} </span>
        <button class="btn-edit" 
                data-taks-id="{{ task.id }}" 
                data-title="{{ task.title }}" 
                data-description="{{ task.description }}" 
                data-category="{{ task.category.id }}">‚úèÔ∏è</button>
        <!-- <a href="{% url 'edit_task' task.id %}">‚úèÔ∏è</a> -->
        <!-- <a href="{% url 'delete_task' task.id %}">üóëÔ∏è</a> -->
        <button class="btn-delete" data-task-id="{{ task.id }}">üóëÔ∏è</button>
        <button class="btn-complete {% if task.completed %}hidden{% endif %}" data-task-id="{{ task.id }}">‚úî –í—ã–ø–æ–ª–Ω–µ–Ω–æ</button>
        <button class="btn-incomplete {% if not task.completed %}hidden{% endif %}" data-task-id="{{ task.id }}"> ‚ùå –ù–µ–≤—ã–ø–æ–ª–Ω–µ–Ω–æ</button>
    </li>
    {% endfor %}
</ul>

<div class="pagination">
    <span class="step-links">
        {% if page_obj.has_previous %}
            <a href="?page=1">&laquo; –ü–µ—Ä–≤–∞—è</a>
            <a href="?page={{ page_obj.previous_page_number }}">–ü—Ä–µ–¥—ã–¥—É—â–∞—è</a>
        {% endif %}

        <span class="current">
            –°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ page_obj.number }} –∏–∑ {{ page_obj.paginator.num_pages}}.
        </span>

        {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}">–°–ª–µ–¥—É—é—â–∞—è</a>
            <a href="?page={{ page_obj.paginator.num_pages }}">–ü–æ—Å–ª–µ–¥–Ω—è—è &raquo;</a>
        {% endif %} 
    </span>
</div>


<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–¥–∞—á–∏ -->
<div id="edit-task-modal" class="modal">
    <div class="modal-content">
        <span class="close-modal" id="close-modal">√ó</span>
        <h2>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–¥–∞—á—É</h2>
        <form id="edit-task-form">
            {% csrf_token %}
            <input type="hidden" id="edit-task-id">

            <label for="edit-title">–ù–∞–∑–≤–∞–Ω–∏–µ:</label>
            <input type="text" id="edit-title" name="title" required>

            <label for="edit-description">–û–ø–∏—Å–∞–Ω–∏–µ:</label>
            <textarea id="edit-description" name="description"></textarea>

            <label for="edit-category">–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</label>
            <select id="edit-category" name="category">
                {% for category in categories %}
                    <option value="{{ category.id }}">{{ category.name }}</option>
                {% endfor %}
            </select>
            <button type="submit">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        </form>
        <a href="{% url 'tasks' %}">–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Å–ø–∏—Å–∫—É –∑–∞–¥–∞—á</a>
    </div>
</div>
<a href="{% url 'logout' %}">–í—ã–π—Ç–∏</a>